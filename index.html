<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#2196F3">
    <meta name="description" content="HotKlick - Interaktive Lern-App mit Hotspots">
    <title>HotKlick - Interaktive Lern-App</title>
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="manifest.json">
    
    <!-- Styles -->
    <link rel="stylesheet" href="css/main.css">
</head>
<body>
    <!-- App Header -->
    <div class="app-header">
        <div class="app-title">HotKlick</div>
        <div class="header-actions">
            <button class="btn-icon" id="btnBack" style="display: none;" title="Zur√ºck">‚Üê</button>
            <button class="btn-icon" id="btnMenu" title="Men√º">‚ãÆ</button>
        </div>
    </div>

    <!-- Main App Container -->
    <div class="app-container">
        <!-- Home Screen -->
        <div class="screen active" id="homeScreen">
            <div class="home-screen">
                <h2>Meine √úbungen</h2>
                <div class="exercise-list" id="exerciseList">
                    <div class="empty-state">
                        <div class="empty-state-icon">üìö</div>
                        <p>Noch keine √úbungen vorhanden</p>
                        <p style="font-size: 14px;">Erstelle deine erste √úbung mit dem + Button</p>
                    </div>
                </div>
            </div>
            <button class="fab" id="btnNewExercise" title="Neue √úbung">+</button>
        </div>

        <!-- Canvas Screen (Editor/Practice) -->
        <div class="screen" id="canvasScreen">
            <div class="canvas-toolbar">
                <div class="mode-toggle">
                    <button id="btnPracticeMode" class="active">√úbungsmodus</button>
                    <button id="btnDeepeningMode">Vertiefungsmodus</button>
                    <button id="btnEditMode">Editiermodus</button>
                </div>
                
                <!-- Radius Controls (nur im Edit-Modus sichtbar) -->
                <div id="radiusControls" class="radius-controls hidden">
                    <button class="btn-icon-small" id="btnDecreaseRadius" title="Radius verkleinern">‚àí</button>
                    <span id="radiusDisplay">20px</span>
                    <button class="btn-icon-small" id="btnIncreaseRadius" title="Radius vergr√∂√üern">+</button>
                </div>

                <!-- Deepening Controls (nur im Deepening-Modus sichtbar) -->
                <div id="deepeningControls" class="deepening-controls hidden">
                    <button class="btn-icon-small" id="btnDeepText" title="Zufall-Text">üìù</button>
                    <button class="btn-icon-small" id="btnDeepAudio" title="Zufall-Audio">üé§</button>
                    <button class="btn-icon-small" id="btnDeepBoth" title="Zufall-Text/Audio">üìùüé§</button>
                    <button class="btn-icon-small" id="btnDeepBack" title="Zur√ºck">‚Üê</button>
                </div>

                <!-- Deepening Stats (nur w√§hrend Aufgaben sichtbar) -->
                <div id="deepeningStats" style="display: none; background: white; padding: 8px 16px; border-radius: 4px; border: 1px solid #E0E0E0; white-space: nowrap;">
                    <strong style="color: #2196F3;">Aufg. <span id="currentTask">1</span>/<span id="totalTasks">10</span></strong>
                    <span style="margin-left: 12px;">‚úÖ <span id="correctCount">0</span></span>
                </div>
                
                <input type="text" id="exerciseName" placeholder="√úbungsname..." style="flex: 1; margin: 0;">
                <button class="btn btn-save-warning" id="btnSave">‚ö†Ô∏è Wichtig - Daten speichern</button>
            </div>
            
            <div class="canvas-container">
                <canvas id="drawingCanvas" width="1024" height="600"></canvas>
            </div>

            <!-- Vertiefungsmodus Frage-Bereich (immer Platz reserviert, nur Inhalt wird sichtbar/unsichtbar) -->
            <div id="deepeningQuestion" style="height: 120px; padding: 16px; background: #F5F5F5; border-top: 1px solid #E0E0E0; visibility: hidden;">
                <div style="background: white; padding: 16px; border-radius: 4px; font-size: 18px; font-weight: 500; min-height: 88px; display: flex; align-items: center; justify-content: center; border: 2px solid #2196F3;">
                    <span id="questionText">Wo ist dieser Hotspot?</span>
                </div>
            </div>
        </div> <!-- Ende canvasScreen -->
    </div> <!-- Ende app-container -->
 
    <!-- New Exercise Dialog -->
    <div class="modal" id="newExerciseModal">
        <div class="modal-content">
            <div class="modal-header">Neue √úbung erstellen</div>
            <label for="newExerciseName">√úbungsname</label>
            <input type="text" id="newExerciseName" placeholder="z.B. Anatomie Herz">
            
            <label for="exerciseImage">Bild ausw√§hlen</label>
            <input type="file" id="exerciseImage" accept="image/*">
            
            <div class="modal-actions">
                <button class="btn" id="btnCancelNewExercise">Abbrechen</button>
                <button class="btn btn-primary" id="btnCreateExercise">Erstellen</button>
            </div>
        </div>
    </div>

    <!-- Text Dialog -->
    <div class="modal" id="textModal">
        <div class="modal-content">
            <div class="modal-header">Hotspot bearbeiten</div>
            <label for="hotspotLabel">Label</label>
            <input type="text" id="hotspotLabel" placeholder="z.B. A1">
            
            <label for="hotspotText">Text</label>
            <textarea id="hotspotText" placeholder="Beschreibung des Hotspots..."></textarea>
            
            <div class="modal-actions">
                <button class="btn" id="btnCancelText">Abbrechen</button>
                <button class="btn btn-primary" id="btnSaveText">Speichern</button>
            </div>
        </div>
    </div>

    <!-- Task Count Dialog -->
    <div class="modal" id="taskCountModal">
        <div class="modal-content">
            <div class="modal-header">Vertiefungsmodus starten</div>
            <label for="taskCount">Wie viele Aufgaben?</label>
            <input type="number" id="taskCount" min="1" max="50" value="10" 
                    style="margin-bottom: 16px; font-size: 18px; text-align: center;">
            <div class="modal-actions">
                <button class="btn" id="btnCancelTasks">Abbrechen</button>
                <button class="btn btn-primary" id="btnStartTasks">Starten</button>
            </div>
        </div>
    </div>

    <!-- Audio Dialog -->
    <div class="modal" id="audioModal">
        <div class="modal-content">
            <div class="modal-header">Audio hinzuf√ºgen</div>
            
            <!-- Audio-Quelle ausw√§hlen (Initial sichtbar) -->
            <div id="choiceSection">
                <p style="margin-bottom: 16px; color: #757575;">Wie m√∂chten Sie das Audio hinzuf√ºgen?</p>
                <div style="display: flex; flex-direction: column; gap: 12px;">
                    <button class="btn btn-primary" id="btnChooseRecord" style="width: 100%; padding: 16px;">
                        üé§ Audio aufnehmen
                    </button>
                    <button class="btn btn-secondary" id="btnChooseFile" style="width: 100%; padding: 16px;">
                        üìÅ Audio-Datei hochladen
                    </button>
                </div>
            </div>
            
            <!-- Aufnahme-Bereich (Initial versteckt) -->
            <div id="recordSection" style="display: none;">
                <button class="btn" id="btnBackToChoice1" style="margin-bottom: 16px;">‚Üê Zur√ºck zur Auswahl</button>
                <div style="text-align: center; padding: 20px; background: #F5F5F5; border-radius: 8px;">
                    <button class="btn btn-primary" id="btnStartRecording" style="width: 100%; margin-bottom: 12px;">üé§ Aufnahme starten</button>
                    <button class="btn btn-danger" id="btnStopRecording" style="display: none; width: 100%; margin-bottom: 12px;">‚èπ Stoppen</button>
                    <div id="recordingTime" style="margin-top: 12px; font-size: 24px; font-weight: bold; display: none;">00:00</div>
                    <audio id="audioPreview" controls style="width: 100%; margin-top: 12px; display: none;"></audio>
                </div>
            </div>
            
            <!-- Datei-Upload-Bereich (Initial versteckt) -->
            <div id="fileSection" style="display: none;">
                <button class="btn" id="btnBackToChoice2" style="margin-bottom: 16px;">‚Üê Zur√ºck zur Auswahl</button>
                <div style="padding: 20px; background: #F5F5F5; border-radius: 8px;">
                    <label for="audioFileInput">Audio-Datei ausw√§hlen (MP3, WAV, OGG)</label>
                    <input type="file" id="audioFileInput" accept="audio/mp3,audio/mpeg,audio/wav,audio/ogg,audio/webm">
                    <audio id="audioFilePreview" controls style="width: 100%; margin-top: 12px; display: none;"></audio>
                </div>
            </div>
            
            <div class="modal-actions">
                <button class="btn" id="btnCancelAudio">Abbrechen</button>
                <button class="btn btn-primary" id="btnSaveAudio">Speichern</button>
            </div>
        </div>
    </div>

    <!-- External Libraries -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    
    <!-- App Scripts -->
    <script src="js/db.js"></script>
    <script src="js/audio-recorder.js"></script>
    <script src="js/canvas-manager.js"></script>
    <script src="js/app.js"></script>
</body>
</html>